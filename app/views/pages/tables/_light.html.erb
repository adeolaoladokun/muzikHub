<div class="card">
  <!-- Card header -->
  <div class="card-header border-0">
    <h3 class="mb-0">Songs</h3>
  </div>
  <!-- Light table -->
  <div class="table-responsive">
    <table class="table align-items-center table-flush">
      <thead class="thead-light">
        <tr>
          <th scope="col" class="sort" data-sort="name">Artist</th>
          <th scope="col" class="sort" data-sort="budget">Title</th>
          <th scope="col" class="sort" data-sort="budget">Price</th>
          <th scope="col">Users</th>
          <th scope="col" class="sort" data-sort="completion">Rating</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody class="list">
        <tr>
          <th scope="row">
            <div class="media align-items-center">
              <a href="#" class="avatar rounded-circle mr-3">
                <%= image_tag "theme/bootstrap.jpg", alt: "..." %>
              </a>
              <div class="media-body">
                <span class="name mb-0 text-sm">Tope Alabi</span>
              </div>
            </div>
          </th>
          <td class="budget">
            Yes and Amen
          </td>
          <td class="budget">
            N4500 Naira
          </td>
          <td>
            <%= render 'pages/tables/avatar_group' %>
          </td>
          <td>
            <%= render partial: 'pages/tables/progress_bar', locals: {
              percent: 60,
              bg_class: 'bg-warning'
            } %>
          </td>
          <td>
              <form id="paymentForm">
                <input type="hidden" name="email" id="email-address" value="<%= current_user.email%>">
                <input type="hidden" name="amount"id="amount" value="4500">
                <input type="hidden" name="first_name"id="first_name" value="Adeola">
                <input type="hidden" name="last_name"id="last_name" value="Oladokun">
                <button type="submit" class="btn btn-sm btn-primary" onclick="payWithPaystack(event)"> Purchase Now </button>
              </form>        
              
          </td>
        </tr>
        <tr>
          <th scope="row">
            <div class="media align-items-center">
              <a href="#" class="avatar rounded-circle mr-3">
                <%= image_tag "theme/angular.jpg", alt: "..." %>
              </a>
              <div class="media-body">
                <span class="name mb-0 text-sm">Tope Alabi</span>
              </div>
            </div>
          </th>
          <td class="budget">
            Imole De
          </td>
          <td class="budget">
            N5000 Naira
          </td>
          <td>
            <%= render 'pages/tables/avatar_group' %>
          </td>
          <td>
            <%= render partial: 'pages/tables/progress_bar', locals: {
              percent: 100,
              bg_class: 'bg-success'
            } %>
          </td>
          <td>
              <a class="btn btn-sm btn-primary" id="acct-btn">Purchase Now</a>            
              
          </td>
        </tr>
        <tr>
          <th scope="row">
            <div class="media align-items-center">
              <a href="#" class="avatar rounded-circle mr-3">
                <%= image_tag "theme/sketch.jpg", alt: "..." %>
              </a>
              <div class="media-body">
                <span class="name mb-0 text-sm">Tope Alabi</span>
              </div>
            </div>
          </th>
          <td class="budget">
            Glory
          </td>
          <td class="budget">
            N6000 Naira
          </td>
          <td>
            <%= render 'pages/tables/avatar_group' %>
          </td>
          <td>
            <%= render partial: 'pages/tables/progress_bar', locals: {
              percent: 72,
              bg_class: 'bg-danger'
            } %>
          </td>
          <td>
              <a class="btn btn-sm btn-primary" id="acct-btn">Purchase Now</a>            
              
          </td>
        </tr>
        <tr>
          <th scope="row">
            <div class="media align-items-center">
              <a href="#" class="avatar rounded-circle mr-3">
                <%= image_tag "theme/react.jpg", alt: "..." %>
              </a>
              <div class="media-body">
                <span class="name mb-0 text-sm">Mercy Chinwo</span>
              </div>
            </div>
          </th>
          <td class="budget">
            Great God
          </td>
          <td class="budget">
            N4400 Naira
          </td>
          <td>
            <%= render 'pages/tables/avatar_group' %>
          </td>
          <td>
            <%= render partial: 'pages/tables/progress_bar', locals: {
              percent: 90,
              bg_class: 'bg-info'
            } %>
          </td>
          <td>
              <a class="btn btn-sm btn-primary" id="acct-btn">Purchase Now</a>            
              
          </td>
        </tr>
        <tr>
          <th scope="row">
            <div class="media align-items-center">
              <a href="#" class="avatar rounded-circle mr-3">
                <%= image_tag "theme/vue.jpg", alt: "..." %>
              </a>
              <div class="media-body">
                <span class="name mb-0 text-sm">Mercy Chinwo</span>
              </div>
            </div>
          </th>
          <td class="budget">
            Halleluyah Praise
          </td>
          <td class="budget">
            N2200 Naira
          </td>
          <td>
            <%= render 'pages/tables/avatar_group' %>
          </td>
          <td>
            <%= render partial: 'pages/tables/progress_bar', locals: {
              percent: 100,
              bg_class: 'bg-success'
            } %>
          </td>
          <td>
              <a class="btn btn-sm btn-primary" id="acct-btn">Purchase Now</a>            
              
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- Card footer -->
  <div class="card-footer py-4">
    <nav aria-label="...">
      <ul class="pagination justify-content-end mb-0">
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1">
            <%= fa_icon 'angle-left' %>
            <span class="sr-only">Previous</span>
          </a>
        </li>
        <li class="page-item active">
          <a class="page-link" href="#">1</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="#">2 <span class="sr-only">(current)</span></a>
        </li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
          <a class="page-link" href="#">
            <%= fa_icon 'angle-right' %>
            <span class="sr-only">Next</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script> 
<script type="text/javascript">
  //console.log(document.getElementById("amount").value);
  const paymentForm = document.getElementById('paymentForm');
  //ref = ''+Math.floor((Math.random() * 1000000000) + 1);
  ref = "<%= @txn_ref %>";
  paymentForm.addEventListener("submit", payWithPaystack, true);
  console.log(ref);
  console.log("<%= @creator_subaccount %>");
  function payWithPaystack(event) {
    event.preventDefault();
    let handler = PaystackPop.setup({
      key: "<%= @test_pub_key %>", // Replace with your public key
      subaccount: "<%= @creator_subaccount %>",
      email: document.getElementById("email-address").value,
      amount: document.getElementById("amount").value * 100,
      metadata:{
        product_id: 1,
         "custom_fields":[
            {
              "display_name":"Artist Name",
              "variable_name":"Artist Name",
              "value":"Tope Alabi"
            },
            {
              "display_name":"Song Title",
              "variable_name":"Song Title",
              "value":"You Are Worthy"
            }
            ]
      },
      ref: ref, // generates a pseudo-unique reference. Please replace with a reference you generated. Or remove the line entirely so our API will generate one for you
      // label: "Optional string that replaces customer email"
      onClose: function(){
        alert('Cancel Transaction?');
      },
      callback: function(response){
        let message = 'Payment complete! Reference: ' + response.reference;
        window.location = "verify/reference?reference=" + response.reference;
        //alert(message);
      }
  })
    handler.openIframe();
  };


</script>